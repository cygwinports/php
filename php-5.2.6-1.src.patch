--- origsrc/php-5.2.6/Makefile.global	2007-08-03 09:01:56.000000000 -0500
+++ src/php-5.2.6/Makefile.global	2008-05-07 14:33:42.593750000 -0500
@@ -39,8 +39,7 @@
 	@test -d modules && \
 	$(mkinstalldirs) $(INSTALL_ROOT)$(EXTENSION_DIR)
 	@echo "Installing shared extensions:     $(INSTALL_ROOT)$(EXTENSION_DIR)/"
-	@rm -f modules/*.la >/dev/null 2>&1
-	@$(INSTALL) modules/* $(INSTALL_ROOT)$(EXTENSION_DIR)
+	@$(INSTALL) modules/*.$(SHLIB_DL_SUFFIX_NAME) $(INSTALL_ROOT)$(EXTENSION_DIR)
 
 install-headers:
 	-@if test "$(INSTALL_HEADERS)"; then \
@@ -132,7 +131,7 @@
 	find . -name \*.gcno -o -name \*.gcda | xargs rm -f
 	find . -name \*.lo -o -name \*.o | xargs rm -f
 	find . -name \*.la -o -name \*.a | xargs rm -f 
-	find . -name \*.so | xargs rm -f
+	find . -name \*.$(SHLIB_DL_SUFFIX_NAME) | xargs rm -f
 	find . -name .libs -a -type d|xargs rm -rf
 	rm -f libphp$(PHP_MAJOR_VERSION).la $(SAPI_CLI_PATH) $(OVERALL_TARGET) modules/* libs/*
 
--- origsrc/php-5.2.6/Zend/zend_API.c	2008-03-06 11:28:47.000000000 -0600
+++ src/php-5.2.6/Zend/zend_API.c	2008-05-07 14:33:42.593750000 -0500
@@ -1559,7 +1559,9 @@
 	lcname = zend_str_tolower_dup(module->name, name_len);
 
 	if (zend_hash_add(&module_registry, lcname, name_len+1, (void *)module, sizeof(zend_module_entry), (void**)&module_ptr)==FAILURE) {
+#if 0
 		zend_error(E_CORE_WARNING, "Module '%s' already loaded", module->name);
+#endif
 		efree(lcname);
 		return NULL;
 	}
--- origsrc/php-5.2.6/acinclude.m4	2007-08-20 09:28:45.000000000 -0500
+++ src/php-5.2.6/acinclude.m4	2008-05-07 14:33:42.609375000 -0500
@@ -850,6 +850,10 @@
       suffix=so
       link_cmd='$(LIBTOOL) --mode=link ifelse($4,,[$(CC)],[$(CXX)]) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -Wl,-G -o '$3'/$1.la -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $($2) $(translit($1,a-z_-,A-Z__)_SHARED_LIBADD) && mv -f '$3'/.libs/$1.so '$3'/$1.so'
       ;;
+    *cygwin*[)]
+      suffix=la
+      link_cmd='$(LIBTOOL) --mode=link ifelse($4,,[$(CC)],[$(CXX)]) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -o [$]@ -shared -export-dynamic -avoid-version -module -no-undefined -rpath $(phplibdir) $(EXTRA_LDFLAGS) $($2) ifelse($1, libphp5lib, , -L$(top_builddir)/cygwin -lphp5lib) $(translit($1,a-z_-,A-Z__)_SHARED_LIBADD)'
+      ;;
     *netware*[)]
       suffix=nlm
       link_cmd='$(LIBTOOL) --mode=link ifelse($4,,[$(CC)],[$(CXX)]) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) $(LDFLAGS) -o [$]@ -shared -export-dynamic -avoid-version -prefer-pic -module -rpath $(phplibdir) $(EXTRA_LDFLAGS) $($2) ifelse($1, php5lib, , -L$(top_builddir)/netware -lphp5lib) $(translit(ifelse($1, php5lib, $1, m4_substr($1, 3)),a-z_-,A-Z__)_SHARED_LIBADD)'
@@ -1976,6 +1980,10 @@
    SHLIB_SUFFIX_NAME=dylib
    SHLIB_DL_SUFFIX_NAME=so
    ;;
+ *cygwin*[)]
+   SHLIB_SUFFIX_NAME=dll.a
+   SHLIB_DL_SUFFIX_NAME=dll
+   ;;
  esac
 ])
 
--- origsrc/php-5.2.6/configure.in	2008-04-30 13:27:55.000000000 -0500
+++ src/php-5.2.6/configure.in	2008-05-07 14:33:42.625000000 -0500
@@ -202,6 +202,13 @@
     PHP_SUBST(PHP5LIB_SHARED_LIBADD)
     PHP_SHARED_MODULE(php5lib, PHP_GLOBAL_OBJS, netware)
     ;;
+*cygwin*)
+    PHP_BUILD_PROGRAM
+    PHP_ADD_SOURCES(/main, internal_functions.c,,PHP_GLOBAL_OBJS)
+    LIBPHP5LIB_SHARED_LIBADD=\$\(EXTRA_LIBS\)
+    PHP_SUBST(LIBPHP5LIB_SHARED_LIBADD)
+    PHP_SHARED_MODULE(libphp5lib, PHP_GLOBAL_OBJS, cygwin)
+    ;;
 esac
 
 # Disable PIC mode by default where it is known to be safe to do so,
@@ -903,7 +910,7 @@
       yes) standard_libtool_flag='-prefer-pic';;
       no)  standard_libtool_flag='-prefer-non-pic';;
     esac
-    EXTRA_LDFLAGS="$EXTRA_LDFLAGS -avoid-version -module"
+    EXTRA_LDFLAGS="$EXTRA_LDFLAGS -avoid-version -module -no-undefined"
 ;;
 esac
 
@@ -1129,6 +1136,12 @@
 AC_DEFINE_UNQUOTED(PHP_BUILD_DATE,"$PHP_BUILD_DATE",[PHP build date])
 
 case $host_alias in
+*cygwin*)
+  PHP_UNAME=`uname -a | xargs`
+  AC_DEFINE_UNQUOTED(PHP_UNAME,"$PHP_UNAME",[uname -a output])
+  PHP_OS="CYGWIN"
+  AC_DEFINE_UNQUOTED(PHP_OS,"$PHP_OS",[uname output])
+  ;;
 *netware*)
   PHP_OS="NetWare"
   PHP_UNAME="NetWare"
--- origsrc/php-5.2.6/ext/dba/config.m4	2007-12-06 08:17:43.000000000 -0600
+++ src/php-5.2.6/ext/dba/config.m4	2008-05-07 14:33:42.640625000 -0500
@@ -175,7 +175,7 @@
   done
   
   if test -n "$THIS_INCLUDE"; then
-    for LIB in ndbm db1 c; do
+    for LIB in ndbm db1 gdbm_compat c; do
       PHP_CHECK_LIBRARY($LIB, dbm_open, [
         AC_DEFINE_UNQUOTED(NDBM_INCLUDE_FILE, "$THIS_INCLUDE", [ ])
         AC_DEFINE(DBA_NDBM, 1, [ ]) 
@@ -462,7 +462,7 @@
   done
 
   if test -n "$THIS_INCLUDE"; then
-    for LIB in dbm c gdbm; do
+    for LIB in dbm c gdbm gdbm_compat; do
       PHP_CHECK_LIBRARY($LIB, dbminit, [
         AC_MSG_CHECKING(for DBM using GDBM)
         AC_DEFINE_UNQUOTED(DBM_INCLUDE_FILE, "$THIS_INCLUDE", [ ])
--- origsrc/php-5.2.6/ext/ldap/config.m4	2007-08-08 06:37:44.000000000 -0500
+++ src/php-5.2.6/ext/ldap/config.m4	2008-05-07 14:33:42.640625000 -0500
@@ -50,7 +50,7 @@
     SASL_LIB="-L$LDAP_SASL_LIBDIR -lsasl2"
   fi
   
-  PHP_CHECK_LIBRARY(ldap, sasl_version,
+  PHP_CHECK_LIBRARY(sasl2, sasl_version,
   [
     PHP_ADD_INCLUDE($LDAP_SASL_INCDIR)
     PHP_ADD_LIBRARY_WITH_PATH(sasl2, $LDAP_SASL_LIBDIR, LDAP_SHARED_LIBADD)
--- origsrc/php-5.2.6/ext/ming/ming.c	2007-12-31 01:20:08.000000000 -0600
+++ src/php-5.2.6/ext/ming/ming.c	2008-05-07 21:36:31.484375000 -0500
@@ -1596,6 +1596,7 @@
 
 /* {{{ proto string swffont::getShape(code)
    Returns the glyph shape of a char as a text string */
+/*
 PHP_METHOD(swffont, getShape)
 {
 	zval **zcode;
@@ -1610,6 +1611,7 @@
 	RETVAL_STRING(result, 1);
 	free(result);
 }
+*/
 /* }}} */
 
 #endif
@@ -1626,7 +1628,7 @@
 	PHP_ME(swffont, getLeading,        NULL, 0)
 #ifdef HAVE_NEW_MING
 /*	PHP_ME(swffont, addchars,          NULL, 0)*/
-	PHP_ME(swffont, getShape,          NULL, 0)
+/*	PHP_ME(swffont, getShape,          NULL, 0)*/
 #endif
 	{ NULL, NULL, NULL }
 };
--- origsrc/php-5.2.6/ext/odbc/config.m4	2007-07-31 08:02:00.000000000 -0500
+++ src/php-5.2.6/ext/odbc/config.m4	2008-05-07 14:33:42.656250000 -0500
@@ -476,6 +476,26 @@
   fi
 fi
 
+if test -z "$ODBC_TYPE"; then
+PHP_ARG_WITH(msodbc,,
+[  --with-msodbc[=DIR]   Include MS-ODBC support [/usr]])
+
+  if test "$PHP_MSODBC" != "no"; then
+    AC_MSG_CHECKING(for MS-ODBC support)
+    if test "$PHP_MSODBC" = "yes"; then
+      PHP_MSODBC=/usr
+    fi
+    ODBC_INCDIR=$PHP_UNIXODBC/include
+    ODBC_LIBDIR=$PHP_UNIXODBC/$PHP_LIBDIR
+    ODBC_LFLAGS=-L$ODBC_LIBDIR
+    ODBC_INCLUDE=-I$ODBC_INCDIR
+    ODBC_LIBS=-lodbc32
+    ODBC_TYPE=msodbc
+    AC_DEFINE(HAVE_MSODBC,1,[ ])
+    AC_MSG_RESULT([$ext_output])
+  fi
+fi
+
 dnl
 dnl Extension setup
 dnl
--- origsrc/php-5.2.6/ext/odbc/php_odbc_includes.h	2007-12-31 01:20:09.000000000 -0600
+++ src/php-5.2.6/ext/odbc/php_odbc_includes.h	2008-05-07 14:33:42.656250000 -0500
@@ -195,6 +195,7 @@
 
 #else /* MS ODBC */
 
+#define ODBC_TYPE "MS ODBC"
 #define HAVE_SQL_EXTENDED_FETCH 1
 #include <WINDOWS.H>
 #include <sql.h>
--- origsrc/php-5.2.6/ext/pdo_odbc/config.m4	2007-07-09 07:35:44.000000000 -0500
+++ src/php-5.2.6/ext/pdo_odbc/config.m4	2008-05-07 14:33:42.671875000 -0500
@@ -84,6 +84,15 @@
         pdo_odbc_def_lib=odbcsdk
         ;;
 
+    ODBC32|odbc32)
+        pdo_odbc_def_libdir=/usr/lib/w32api
+        pdo_odbc_def_incdir=/usr/include/w32api
+        pdo_odbc_def_lib=odbc32
+        # w32api libs require the correct number of args, unlike AC_CHECK_LIB
+        ac_cv_lib_odbc32___SQLBindCol=yes
+        ac_cv_lib_odbc32___SQLAllocHandle=yes
+        ;;
+
     generic)
         pdo_odbc_def_lib="`echo $PHP_PDO_ODBC | cut -d, -f3`"
         pdo_odbc_def_ldflags="`echo $PHP_PDO_ODBC | cut -d, -f4`"
--- origsrc/php-5.2.6/ext/pdo_odbc/php_pdo_odbc_int.h	2007-12-31 01:20:10.000000000 -0600
+++ src/php-5.2.6/ext/pdo_odbc/php_pdo_odbc_int.h	2008-05-07 14:33:42.687500000 -0500
@@ -22,6 +22,11 @@
 # define PDO_ODBC_TYPE	"Win32"
 #endif
 
+#if defined(__CYGWIN__)
+# define WIN32_LEAN_AND_MEAN
+# include <windows.h>
+#endif
+
 #ifndef PDO_ODBC_TYPE
 # warning Please fix configure to give your ODBC libraries a name
 # define PDO_ODBC_TYPE	"Unknown"
@@ -43,6 +48,10 @@
 # include <iodbc.h>
 #endif
 
+#if HAVE_SQL_H
+# include <sql.h>
+#endif
+
 #if HAVE_SQLUNIX_H && !defined(PHP_WIN32)
 # include <sqlunix.h>
 #endif
@@ -55,10 +64,6 @@
 # include <sqlucode.h>
 #endif
 
-#if HAVE_SQL_H
-# include <sql.h>
-#endif
-
 #if HAVE_ISQL_H
 # include <isql.h>
 #endif
--- origsrc/php-5.2.6/ext/pspell/config.m4	2005-05-29 18:16:43.000000000 -0500
+++ src/php-5.2.6/ext/pspell/config.m4	2008-05-07 14:33:42.703125000 -0500
@@ -29,8 +29,6 @@
 
 	PSPELL_LIBDIR=$PSPELL_DIR/$PHP_LIBDIR
 
-	PHP_ADD_LIBRARY_WITH_PATH(pspell, $PSPELL_LIBDIR, PSPELL_SHARED_LIBADD)
-
 	dnl Add -laspell to LIBS if it exists
 	PHP_CHECK_LIBRARY(aspell,new_aspell_config,
 	[
--- origsrc/php-5.2.6/ext/recode/config9.m4	2004-11-09 10:11:13.000000000 -0600
+++ src/php-5.2.6/ext/recode/config9.m4	2008-05-07 17:40:09.343750000 -0500
@@ -8,6 +8,6 @@
   test "$PHP_MYSQL" != "no" && recode_conflict="$recode_conflict mysql"
 
   if test -n "$recode_conflict"; then
-    AC_MSG_ERROR([recode extension can not be configured together with:$recode_conflict])
+    AC_MSG_WARN([recode extension can not be loaded together with:$recode_conflict])
   fi
 fi
--- origsrc/php-5.2.6/ext/xmlrpc/config.m4	2005-11-29 12:26:02.000000000 -0600
+++ src/php-5.2.6/ext/xmlrpc/config.m4	2008-05-07 21:53:48.359375000 -0500
@@ -112,7 +112,7 @@
   fi
 
   PHP_ADD_INCLUDE($XMLRPC_DIR)
-  PHP_ADD_LIBRARY_WITH_PATH(xmlrpc, $XMLRPC_DIR/$PHP_LIBDIR, XMLRPC_SHARED_LIBADD)
+  PHP_ADD_LIBRARY_WITH_PATH(xmlrpc-epi, $XMLRPC_DIR/$PHP_LIBDIR, XMLRPC_SHARED_LIBADD)
   PHP_NEW_EXTENSION(xmlrpc,xmlrpc-epi-php.c, $ext_shared)
   XMLRPC_MODULE_TYPE=external
 fi
--- origsrc/php-5.2.6/sapi/apache/config.m4	2007-07-11 18:20:36.000000000 -0500
+++ src/php-5.2.6/sapi/apache/config.m4	2008-05-07 14:33:42.718750000 -0500
@@ -75,6 +75,10 @@
     PHP_AIX_LDFLAGS="-Wl,-brtl"
     build_type=shared
     ;;
+  *cygwin*)
+    EXTRA_LDFLAGS="$EXTRA_LDFLAGS -lhttpd"
+    build_type=shared
+    ;;
   *darwin*)
     MH_BUNDLE_FLAGS="-dynamic -twolevel_namespace -bundle -bundle_loader $APXS_HTTPD"
     PHP_SUBST(MH_BUNDLE_FLAGS)
--- origsrc/php-5.2.6/sapi/apache2handler/config.m4	2007-07-11 18:20:36.000000000 -0500
+++ src/php-5.2.6/sapi/apache2handler/config.m4	2008-05-07 14:33:42.718750000 -0500
@@ -49,7 +49,9 @@
     echo $APU_BINDIR/apu-config`
 
   APR_CFLAGS="`$APR_CONFIG --cppflags --includes`"
+  APR_LIBS="`$APR_CONFIG --ldflags --link-ld`"
   APU_CFLAGS="`$APU_CONFIG --includes`"
+  APU_LIBS="`$APU_CONFIG --ldflags --link-ld`"
 
   for flag in $APXS_CFLAGS; do
     case $flag in
@@ -58,6 +60,7 @@
   done
 
   APACHE_CFLAGS="$APACHE_CPPFLAGS -I$APXS_INCLUDEDIR $APR_CFLAGS $APU_CFLAGS"
+  EXTRA_LIBS="$APR_LIBS $APU_LIBS"
 
   # Test that we're trying to configure with apache 2.x
   PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
@@ -87,17 +90,12 @@
     PHP_SELECT_SAPI(apache2handler, shared, mod_php5.c sapi_apache2.c apache_config.c php_functions.c, $APACHE_CFLAGS)
     INSTALL_IT="$INSTALL_IT $SAPI_LIBTOOL" 
     ;;
+  *cygwin*)
+    EXTRA_LDFLAGS="-shrext .so $EXTRA_LDFLAGS -L`$APXS -q LIBDIR` -lhttpd2core"
+    PHP_SELECT_SAPI(apache2handler, shared, mod_php5.c sapi_apache2.c apache_config.c php_functions.c, $APACHE_CFLAGS) 
+    INSTALL_IT="$INSTALL_IT $SAPI_LIBTOOL"
+    ;;
   *darwin*)
-    dnl When using bundles on Darwin, we must resolve all symbols.  However,
-    dnl the linker does not recursively look at the bundle loader and
-    dnl pull in its dependencies.  Therefore, we must pull in the APR
-    dnl and APR-util libraries.
-    if test -x "$APR_CONFIG"; then
-        MH_BUNDLE_FLAGS="`$APR_CONFIG --ldflags --link-ld --libs`"
-    fi
-    if test -x "$APU_CONFIG"; then
-        MH_BUNDLE_FLAGS="`$APU_CONFIG --ldflags --link-ld --libs` $MH_BUNDLE_FLAGS"
-    fi
     MH_BUNDLE_FLAGS="-bundle -bundle_loader $APXS_HTTPD $MH_BUNDLE_FLAGS"
     PHP_SUBST(MH_BUNDLE_FLAGS)
     PHP_SELECT_SAPI(apache2handler, bundle, mod_php5.c sapi_apache2.c apache_config.c php_functions.c, $APACHE_CFLAGS)
--- origsrc/php-5.2.6/sapi/cgi/config9.m4	2007-07-11 18:20:36.000000000 -0500
+++ src/php-5.2.6/sapi/cgi/config9.m4	2008-05-07 14:33:42.734375000 -0500
@@ -92,6 +92,9 @@
       *aix*)
         BUILD_CGI="echo '\#! .' > php.sym && echo >>php.sym && nm -BCpg \`echo \$(PHP_GLOBAL_OBJS) \$(PHP_SAPI_OBJS) | sed 's/\([A-Za-z0-9_]*\)\.lo/\1.o/g'\` | \$(AWK) '{ if (((\$\$2 == \"T\") || (\$\$2 == \"D\") || (\$\$2 == \"B\")) && (substr(\$\$3,1,1) != \".\")) { print \$\$3 } }' | sort -u >> php.sym && \$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) -Wl,-brtl -Wl,-bE:php.sym \$(PHP_RPATHS) \$(PHP_GLOBAL_OBJS) \$(PHP_SAPI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CGI_PATH)"
         ;;
+      *cygwin*)
+        BUILD_CGI="\$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(PHP_SAPI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -Lcygwin -lphp5lib -o \$(SAPI_CGI_PATH)"
+      ;;
       *darwin*)
         BUILD_CGI="\$(CC) \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(NATIVE_RPATHS) \$(PHP_GLOBAL_OBJS:.lo=.o) \$(PHP_SAPI_OBJS:.lo=.o) \$(PHP_FRAMEWORKS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CGI_PATH)"
       ;;
--- origsrc/php-5.2.6/sapi/cli/config.m4	2007-07-11 18:20:36.000000000 -0500
+++ src/php-5.2.6/sapi/cli/config.m4	2008-05-07 14:33:42.734375000 -0500
@@ -16,6 +16,10 @@
   *aix*)
     BUILD_CLI="echo '\#! .' > php.sym && echo >>php.sym && nm -BCpg \`echo \$(PHP_GLOBAL_OBJS) \$(PHP_CLI_OBJS) | sed 's/\([A-Za-z0-9_]*\)\.lo/\1.o/g'\` | \$(AWK) '{ if (((\$\$2 == \"T\") || (\$\$2 == \"D\") || (\$\$2 == \"B\")) && (substr(\$\$3,1,1) != \".\")) { print \$\$3 } }' | sort -u >> php.sym && \$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) -Wl,-brtl -Wl,-bE:php.sym \$(PHP_RPATHS) \$(PHP_GLOBAL_OBJS) \$(PHP_CLI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CLI_PATH)"
     ;;
+  *cygwin*)
+    SAPI_CLI_PATH=sapi/cli/php.exe
+    BUILD_CLI="\$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(PHP_CLI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -Lcygwin -lphp5lib -o \$(SAPI_CLI_PATH)"
+    ;;
   *darwin*)
     BUILD_CLI="\$(CC) \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(NATIVE_RPATHS) \$(PHP_GLOBAL_OBJS:.lo=.o) \$(PHP_CLI_OBJS:.lo=.o) \$(PHP_FRAMEWORKS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CLI_PATH)"
     ;;
